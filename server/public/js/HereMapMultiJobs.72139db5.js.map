{"version":3,"sources":["webpack:///./src/components/hereMaps/HereMapMultiJobs.vue?0e49","webpack:///src/components/hereMaps/HereMapMultiJobs.vue","webpack:///./src/components/hereMaps/HereMapMultiJobs.vue?6474","webpack:///./src/components/hereMaps/HereMapMultiJobs.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","staticRenderFns","component"],"mappings":"2HAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,OAAO,CAACF,EAAG,MAAM,CAACG,IAAI,UAAUD,YAAY,2BAC9JE,EAAkB,G,oHCOtB,GACE,KAAF,mBACE,MAAF,CACI,KAAJ,CAAM,KAAN,MAAM,QAAN,uBAEE,KALF,WAMI,MAAJ,CACM,SAAN,KACM,IAAN,KACM,GAAN,KACM,OAAN,8CACM,sBAAN,SAGE,MAAF,CACI,KADJ,WAEA,WACQ,KAAR,gBACQ,KAAR,gBAIE,QAtBF,WAsBI,IAAJ,OAAI,OAAJ,qKAGA,+DAHA,uBAIA,aACA,kEACA,cACA,sDAEA,+DATA,OAYA,iCACA,kBAEA,aACA,sBAhBA,kHAqBE,QAAF,CACI,QADJ,SACA,GACM,KAAN,iDAEI,kBAJJ,WAIM,IAAN,OAAM,OAAN,oKAEA,MAFA,kBAMA,2BACA,iDACA,YACA,UACA,IACA,GACA,sBACA,0BAGA,SAGA,wDAnBA,OAMA,EANA,0DAuBA,+BAvBA,QA0BA,IACA,gCAGA,kBACA,WACA,kCACA,yBAGA,uCACA,OACA,WAGA,6EAEA,2DAEA,oCAEA,eA/CA,qDAiDA,kEACA,0BACA,iBACA,iCACA,SACA,gBAtDA,mEA0DI,WA9DJ,WA8DM,IAAN,OAAM,OAAN,kJACA,yBACA,WACA,kBAEA,+BACA,yBAEA,oBARA,8CAWI,mBAzEJ,SAyEA,GAAM,IAAN,OACM,OAAN,mBACQ,MAAR,CACU,QAAV,CACY,IAAZ,qCACY,IAAZ,sCAEU,YAAV,eACU,QAAV,kBACU,KAAV,CACA,CACY,SAAZ,QACY,MAAZ,aAMI,cA3FJ,SA2FA,OAAM,IAAN,OAsCM,OArCA,EAAN,mBAAQ,IAAR,yJACA,YAEA,gCACA,8BAEA,gCACA,8BACA,oCAEA,iBAEA,uBAEA,gCACA,SAGA,EAlBA,+CAkBA,cAlBA,sCAmBA,4BACA,GACA,wDACA,QADA,6BACA,WADA,kCAIA,aAEA,sCACA,kDACA,6BAEA,qBAGA,eAlCA,4CAAQ,OAAR,gDAqCA,GAEI,cAnIJ,WAoIA,UACQ,KAAR,0CAGI,aAxIJ,SAwIA,GACM,IAAN,OACM,OACN,qCC9LyW,I,YCOrWC,EAAY,eACd,EACAV,EACAS,GACA,EACA,KACA,KACA,MAIa,aAAAC,E","file":"js/HereMapMultiJobs.72139db5.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"map\"},[_c('div',{ref:\"hereMap\",staticClass:\"map-container multi\"})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"map\">\r\n    <div ref=\"hereMap\" class=\"map-container multi\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import { companyCountryOptions } from \"@/config/formDataConfig.json\";\r\n  export default {\r\n    name: \"HereMapMultiJobs\",\r\n    props: {\r\n      jobs: { type: Array, default: () => [] }\r\n    },\r\n    data() {\r\n      return {\r\n        platform: null,\r\n        map: null,\r\n        ui: null,\r\n        apikey: \"n3GOlcV0Z6utqCKpJlDWH6lWYtJdvR0QomMzYs_EreM\",\r\n        companyCountryOptions\r\n      };\r\n    },\r\n    watch: {\r\n      jobs() {\r\n        if (this.map) {\r\n          this.deleteMarkers();\r\n          this.addMarkers();\r\n        }\r\n      }\r\n    },\r\n    async mounted() {\r\n      try {\r\n        // Script is loaded, do something\r\n        await this.$loadScript(\"https://js.api.here.com/v3/3.1/mapsjs-core.js\");\r\n        await Promise.all([\r\n          this.$loadScript(\"https://js.api.here.com/v3/3.1/mapsjs-service.js\"),\r\n          this.$loadScript(\r\n            \"https://js.api.here.com/v3/3.1/mapsjs-mapevents.js\"\r\n          ),\r\n          this.$loadScript(\"https://js.api.here.com/v3/3.1/mapsjs-ui.js\")\r\n        ]);\r\n\r\n        const platform = new window.H.service.Platform({\r\n          apikey: this.apikey\r\n        });\r\n        this.platform = platform;\r\n        this.initializeHereMap();\r\n      } catch (err) {\r\n        // Failed to fetch script\r\n      }\r\n    },\r\n    methods: {\r\n      forward(jobId) {\r\n        this.$router.push(`/stellenangebote/job/${jobId}`);\r\n      },\r\n      async initializeHereMap() {\r\n        try {\r\n          let zoom = 6.3;\r\n          let geocode;\r\n\r\n          try {\r\n            geocode = await new Promise((resolve, reject) => {\r\n              window.navigator.geolocation.getCurrentPosition(\r\n                position => {\r\n                  if (position.coords) {\r\n                    zoom = 8;\r\n                    resolve({\r\n                      lat: position.coords.latitude,\r\n                      lng: position.coords.longitude\r\n                    });\r\n                  } else {\r\n                    reject(\"\");\r\n                  }\r\n                },\r\n                () => resolve(this.$config.maps.defaultCenter)\r\n              );\r\n            });\r\n          } catch (err) {\r\n            geocode = this.$config.maps.defaultCenter;\r\n          }\r\n\r\n          if (!geocode) {\r\n            geocode = this.$config.maps.defaultCenter;\r\n          }\r\n\r\n          const mapContainer = this.$refs.hereMap;\r\n          const H = window.H;\r\n          const maptypes = this.platform.createDefaultLayers({\r\n            lg: this.$config.maps.lang\r\n          });\r\n\r\n          this.map = new H.Map(mapContainer, maptypes.vector.normal.map, {\r\n            zoom,\r\n            center: geocode\r\n          });\r\n\r\n          addEventListener(\"resize\", () => this.map.getViewPort().resize());\r\n\r\n          new H.mapevents.Behavior(new H.mapevents.MapEvents(this.map));\r\n\r\n          this.ui = H.ui.UI.createDefault(this.map, maptypes);\r\n\r\n          this.addMarkers();\r\n        } catch (err) {\r\n          this.$root.$bvToast.toast(`Die Karte konnten nicht geladen werden.`, {\r\n            title: `Fehler beim Laden`,\r\n            variant: \"danger\",\r\n            toaster: \"b-toaster-bottom-right\",\r\n            solid: true,\r\n            noAutoHide: false\r\n          });\r\n        }\r\n      },\r\n      async addMarkers() {\r\n        if (this.map && this.jobs.length > 0) {\r\n          const H = window.H;\r\n          const group = new H.map.Group();\r\n\r\n          const markersInput = this.createMarkersInput(this.jobs);\r\n          const markersGroup = this.createMarkers(H, group, markersInput);\r\n\r\n          this.map.addObject(markersGroup);\r\n        }\r\n      },\r\n      createMarkersInput(jobs) {\r\n        return jobs.map(job => {\r\n          return {\r\n            geocode: {\r\n              lat: this.spreadMarker(job.company.geoCodeLat),\r\n              lng: this.spreadMarker(job.company.geoCodeLng)\r\n            },\r\n            companyName: job.company.name,\r\n            logoUrl: job.company.logoUrl,\r\n            jobs: [\r\n              {\r\n                jobTitle: job.title,\r\n                jobId: job._id\r\n              }\r\n            ]\r\n          };\r\n        });\r\n      },\r\n      createMarkers(H, group, markersInput) {\r\n        markersInput.forEach(async markerObject => {\r\n          const geocode = markerObject.geocode;\r\n\r\n          const outerElement = document.createElement(\"div\");\r\n          outerElement.classList.add(\"icon-outer\");\r\n\r\n          const innerElement = document.createElement(\"img\");\r\n          innerElement.classList.add(\"icon-inner\");\r\n          innerElement.src = markerObject.logoUrl || \"/img/favicon.ico\";\r\n\r\n          outerElement.appendChild(innerElement);\r\n\r\n          const domIcon = new H.map.DomIcon(outerElement);\r\n\r\n          const marker = new window.H.map.DomMarker(geocode, {\r\n            icon: domIcon\r\n          });\r\n\r\n          let markerHtml = `<div class=\"map-bubble mb-2\"><strong>${markerObject.companyName}</strong></div><hr class=\"my-1\" />`;\r\n          markerObject.jobs.forEach(job => {\r\n            markerHtml =\r\n              markerHtml +\r\n              `<p class=\"my-0\"><a href=\"/stellenangebote/job/${job.jobId}\" target=\"_blank\">${job.jobTitle}</a></p><hr class=\"my-1\" />`;\r\n          });\r\n\r\n          marker.setData(markerHtml);\r\n\r\n          marker.addEventListener(\"tap\", evt => {\r\n            var bubble = new H.ui.InfoBubble(evt.target.getGeometry(), {\r\n              content: evt.target.getData()\r\n            });\r\n            this.ui.addBubble(bubble);\r\n          });\r\n\r\n          group.addObject(marker);\r\n        });\r\n\r\n        return group;\r\n      },\r\n      deleteMarkers() {\r\n        if (this.map) {\r\n          this.map.removeObjects(this.map.getObjects());\r\n        }\r\n      },\r\n      spreadMarker(val) {\r\n        const markerSpread = 0.0005;\r\n        return (\r\n          val + Math.random() * markerSpread - Math.random() * markerSpread\r\n        );\r\n      }\r\n    }\r\n  };\r\n</script>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HereMapMultiJobs.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HereMapMultiJobs.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./HereMapMultiJobs.vue?vue&type=template&id=20a2596b&\"\nimport script from \"./HereMapMultiJobs.vue?vue&type=script&lang=js&\"\nexport * from \"./HereMapMultiJobs.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}